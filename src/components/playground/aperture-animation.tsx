'use client'

import { gsap } from 'gsap'
import { useEffect, useRef, useState } from 'react'
import { cn } from '@/lib/utils'

interface ApertureAnimationProps {
  size?: number
  className?: string
  showPercentage?: boolean
}

export function ApertureAnimation({
  size = 200,
  className = '',
  showPercentage = true,
}: ApertureAnimationProps) {
  const [percentage, setPercentage] = useState(0)
  const svgRef = useRef<SVGSVGElement>(null)
  const apertureRef = useRef<gsap.core.Timeline | null>(null)

  const paths = [
    'M147.3,99.1c-26.9,16-51.9,6.4-65.7-4.7c0.5-0.1,0.9-0.1,1.4-0.1c16.8-2,49.8-18.5,52.7-56.7c9,11.8,14.4,26.5,14.4,42.4C150,86.5,149.1,92.9,147.3,99.1z M130.2,31.3c0.4,31.2-20.3,48-36.9,54.5c0.2-0.4,0.3-0.8,0.4-1.1l0.1,0c6.7-15.5,9-52.5-22.7-74.1C74,10.2,77,10,80,10C99.7,10,117.5,18.2,130.2,31.3z M62.9,12.1c27.3,15.3,31.5,41.7,28.8,59.3c-0.2-0.3-0.5-0.6-0.8-1l0,0C80.8,56.8,50,36.3,15.4,53C23.8,32.9,41.4,17.5,62.9,12.1L62.9,12.1z M12.7,60.9c26.9-16,51.9-6.4,65.7,4.7c-0.5,0-0.9,0.1-1.4,0.1c-16.8,2-49.8,18.5-52.7,56.7C15.3,110.6,10,95.9,10,80C10,73.4,10.9,67,12.7,60.9z M29.8,128.7c-0.4-31.2,20.3-48,36.9-54.5c-0.2,0.4-0.3,0.8-0.4,1.1l-0.1,0c-6.7,15.5-9,52.5,22.7,74.1C86,149.8,83,150,80,150C60.3,150,42.5,141.8,29.8,128.7L29.8,128.7z M97.1,147.9c-27.3-15.3-31.5-41.7-28.8-59.3c0.2,0.3,0.5,0.6,0.8,1l0,0c7.4,9.9,26,23.6,49,23.6c8.4,0,17.3-1.9,26.5-6.3C136.2,127.1,118.6,142.5,97.1,147.9z',
    'M150,80c0,9.9-2.1,19.8-6.2,28.8c-26.1,8.9-49.4-1.4-62.9-12.5c0.8,0,1.7-0.1,2.5-0.3c16.9-2,48.2-16.9,57.7-50.2C146.9,56.2,150,68,150,80L150,80z M136.8,39.2c-5.4,27-25.9,42.1-42.3,48.2c0.4-0.7,0.7-1.5,0.9-2.2l0,0c6.7-15.6,9.6-50.3-14.7-75.2C103.9,10.3,124.3,21.7,136.8,39.2L136.8,39.2z M73.1,10.3c20.7,18.2,23.6,43.5,20.6,60.8c-0.4-0.7-0.9-1.3-1.5-1.9l0,0C82.1,55.5,53.5,35.8,19.8,44.3C30.9,25.6,50.4,12.6,73.1,10.3L73.1,10.3z M10,80c0-9.9,2.1-19.8,6.2-28.8c26.1-8.8,49.4,1.4,62.9,12.5c-0.8,0-1.7,0.1-2.5,0.3C59.7,66,28.4,80.9,19,114.2C13.1,103.8,10,92,10,80L10,80z M23.1,120.8c5.4-27,25.9-42.1,42.3-48.2c-0.4,0.7-0.7,1.5-0.9,2.2h0C57.8,90.4,55,125.1,79.2,150C56.1,149.7,35.7,138.2,23.1,120.8L23.1,120.8z M86.9,149.6c-20.7-18.2-23.6-43.5-20.6-60.8c0.4,0.7,0.9,1.3,1.5,1.9l0,0c8.5,11.3,29.7,27,56,27c5.3,0,10.8-0.7,16.4-2.1C129.1,134.3,109.6,147.4,86.9,149.6L86.9,149.6z',
    'M150,80c0,13-3.6,25.8-10.5,36.8c-25,3.3-46.5-7.3-59.6-18.4c0,0,0.1,0,0.1,0c1.3,0,2.5-0.1,3.8-0.4c17-2,46.7-15.4,61-44.5C148.2,61.9,150,70.9,150,80L150,80z M141.6,46.8C132,70.1,112,83.5,95.8,89.3c0.7-1.1,1.2-2.3,1.6-3.5h0c6.7-15.7,10.1-48.2-8-75.2C112,13.7,131.2,27.6,141.6,46.8L141.6,46.8z M80,10c0.7,0,1.4,0,2.1,0.1c15.3,20,17,44,13.8,60.9c-0.6-1.1-1.4-2.1-2.2-3.1l0,0C83.5,54.1,57.1,35,24.7,37.1C37.5,20.6,57.5,10,80,10L80,10z M10,80c0-13,3.6-25.8,10.5-36.8c25-3.3,46.5,7.3,59.6,18.5c0,0-0.1,0-0.1,0c-1.3,0-2.5,0.1-3.8,0.4c-17,2-46.7,15.4-61,44.5C11.8,98.1,10,89.1,10,80z M18.4,113.2C28,89.9,48,76.5,64.2,70.7c-0.7,1.1-1.2,2.3-1.6,3.5h0c-6.7,15.7-10.1,48.2,8,75.2C48,146.3,28.8,132.4,18.4,113.2L18.4,113.2z M80,150c-0.7,0-1.4,0-2.1-0.1c-15.3-20-17-44-13.8-60.9c0.6,1.1,1.4,2.1,2.2,3.1l0,0c9.7,13,34,30.9,64.1,30.9c1.6,0,3.3-0.1,4.9-0.2C122.5,139.4,102.5,150,80,150L80,150z',
    'M150,80c0,16.4-5.7,31.5-15.1,43.4c-23.6-0.8-43.6-11.7-56.2-22.8c0.4,0,0.9,0.1,1.3,0.1c1.5,0,2.9-0.2,4.3-0.4c17-2,45.3-14.1,63.1-39.4C149.1,67.1,150,73.5,150,80L150,80z M145,54.1c-12.5,20-31.9,31.9-47.8,37.3c1-1.5,1.8-3.2,2.4-5l0,0c6.8-15.8,10.5-46.3-2.6-74.4C119,17.6,136.8,33.5,145,54.1L145,54.1z M80,10c3.4,0,6.8,0.3,10.1,0.7c11.1,20.8,11.7,43.6,8.4,60.1c-0.8-1.7-1.9-3.2-3.1-4.6l0,0C85.2,52.5,60.6,34,29.8,31.3C42.5,18.2,60.3,10,80,10L80,10z M10,80c0-16.4,5.7-31.5,15.1-43.4c23.6,0.8,43.6,11.7,56.2,22.8c-0.4,0-0.9-0.1-1.3-0.1c-1.4,0-2.9,0.2-4.3,0.4c-17,2-45.3,14.1-63.1,39.4C10.9,92.9,10,86.5,10,80L10,80z M15,105.9c12.5-20,31.9-31.9,47.8-37.3c-1,1.5-1.8,3.2-2.4,5l0,0c-6.8,15.8-10.5,46.3,2.6,74.4C41,142.4,23.2,126.5,15,105.9L15,105.9z M80,150c-3.4,0-6.8-0.3-10.1-0.7c-11.1-20.8-11.7-43.6-8.4-60.1c0.8,1.7,1.9,3.2,3.1,4.6l0,0c10.3,13.7,34.8,32.2,65.7,35C117.5,141.8,99.7,150,80,150z',
    'M150,80c0,19-7.6,36.3-20,49c-22-3.8-40.5-14.8-52.7-25.8c0.9,0.1,1.8,0.2,2.7,0.2c1.7,0,3.3-0.2,4.8-0.5c17.1-2,44-12.8,64.1-35C149.7,71.9,150,75.9,150,80L150,80z M147.4,61.2C133.1,78.4,114.3,88.9,98.7,94c1.5-2,2.7-4.3,3.5-6.7l0,0c6.8-15.8,10.9-44.6,1.8-73.1C125.2,22,141.3,39.5,147.4,61.2L147.4,61.2z M80,10c6,0,11.8,0.8,17.4,2.2c7.7,21,7.5,42.5,4.1,58.6c-1-2.3-2.4-4.4-4.1-6.3l0,0C87.2,50.7,64.3,32.7,35.1,26.3C47.3,16.1,62.9,10,80,10z M10,80c0-19,7.7-36.3,20-49c22,3.8,40.5,14.8,52.7,25.8c-0.9-0.1-1.8-0.2-2.7-0.2c-1.6,0-3.2,0.2-4.8,0.5c-17.1,2-44,12.8-64.1,35C10.3,88.1,10,84.1,10,80L10,80z M12.6,98.8C26.9,81.6,45.7,71.1,61.3,66c-1.5,2-2.7,4.2-3.5,6.7l0,0C51,88.5,46.9,117.3,56,145.8C35,138.1,18.7,120.6,12.6,98.8z M80,150c-6,0-11.8-0.8-17.4-2.2c-7.7-21-7.5-42.5-4.1-58.6c1,2.3,2.4,4.4,4.1,6.3l0,0c10.3,13.8,33.1,31.7,62.3,38.1C112.7,143.9,97.1,150,80,150L80,150z',
    'M150,80c0,21.6-9.8,40.9-25.2,53.8c-20.4-6-37.5-16.9-49.2-27.7c1.4,0.2,2.9,0.4,4.4,0.4c1.9,0,3.7-0.2,5.5-0.6c17.1-2,42.7-11.7,64.3-31C149.9,76.6,150,78.3,150,80z M149,68.1c-15.4,14.7-33.4,24-48.6,28.8c2.1-2.6,3.7-5.5,4.8-8.6l0,0c6.8-15.8,11.3-42.9,5.3-71.3C130.4,26.7,145.1,45.6,149,68.1L149,68.1z M80,10c8.2,0,16.4,1.4,24.2,4.3c5.1,20.7,4.1,41,0.6,56.5c-1.2-3.1-2.9-6-5.1-8.4l0,0c-10.3-13.8-31.5-31.2-59-40.2C52.3,14.2,66,10,80,10L80,10z M10,80c0-21.6,9.8-40.9,25.2-53.8c20.4,6,37.5,16.9,49.2,27.7c-1.4-0.2-2.9-0.4-4.4-0.4c-1.9,0-3.7,0.2-5.5,0.6c-17.1,2-42.8,11.7-64.3,31C10.1,83.4,10,81.7,10,80L10,80z M11,91.9c15.4-14.7,33.4-24,48.6-28.8c-2.1,2.5-3.7,5.5-4.8,8.6l0,0c-6.8,15.8-11.2,42.9-5.3,71.3C29.6,133.3,14.9,114.4,11,91.9z M80,150c-8.2,0-16.4-1.4-24.2-4.3c-5.1-20.7-4.1-41-0.6-56.5c1.2,3.1,2.9,6,5.1,8.4l0,0c10.3,13.8,31.5,31.2,59.1,40.2C107.8,145.8,94,150,80,150z',
    'M119.1,138c-18.7-7.4-34.4-18.2-45.6-28.7c2.1,0.5,4.3,0.7,6.4,0.7c2.1,0,4.2-0.2,6.2-0.7c17-2,41.4-10.6,63.8-27.3C149.2,105.3,137.2,125.8,119.1,138z M149.8,75.1c-15.8,12.5-33,20.7-47.7,25.1c2.9-3.1,5.1-6.9,6.4-10.9l0,0c6.7-15.7,11.5-41.2,8.2-68.9C135.3,32,148.2,52,149.8,75.1z M79.9,10c10.6,0,21.1,2.4,30.7,7.1c2.9,19.9,1.5,38.9-2.1,53.8c-1.3-4.1-3.5-7.8-6.3-10.9l0,0C92.1,46.3,72.3,29.4,46.7,18.4C56.9,12.9,68.3,10,79.9,10z M40.8,22c18.7,7.4,34.4,18.2,45.6,28.7c-2.1-0.5-4.3-0.7-6.4-0.7c-2.1,0-4.2,0.2-6.2,0.7c-17,2-41.4,10.7-63.7,27.3C10.7,54.7,22.7,34.2,40.8,22L40.8,22z M10.1,84.9c15.8-12.5,33-20.7,47.7-25.1c-2.9,3.1-5.1,6.8-6.4,10.9l0,0c-6.7,15.7-11.5,41.2-8.2,68.9C24.6,128,11.7,108,10.1,84.9z M79.9,150c-10.6,0-21.1-2.4-30.7-7.1c-2.9-19.9-1.5-38.9,2.1-53.8c1.3,4.1,3.5,7.8,6.3,10.9l0,0c10.2,13.7,29.9,30.6,55.6,41.6C103,147.1,91.5,150,79.9,150L79.9,150z',
    'M112.8,141.8c-16.9-8.3-31.1-18.7-41.7-28.9c2.8,0.8,5.8,1.2,8.9,1.2c2.4,0,4.8-0.3,7.1-0.8v0c16.7-2,39.8-9.6,62.3-23.9C146.3,112.2,132.3,131.5,112.8,141.8L112.8,141.8z M150,80c0,0.8,0,1.7-0.1,2.5c-15.6,10.5-31.8,17.6-45.9,21.6c3.8-3.8,6.7-8.5,8.3-13.6l0,0c6.7-15.5,11.6-39.3,10.5-65.8C139.4,37.5,150,57.5,150,80L150,80z M80,10c13.1,0,26,3.7,37.1,10.7c1.3,18.8-0.7,36.3-4.2,50.5c-1.4-5.2-4-10-7.6-14l0,0c-10.1-13.5-28.2-29.7-51.8-42C62,11.7,70.9,10,80,10L80,10z M47.2,18.2c16.9,8.3,31.1,18.7,41.7,28.9c-2.8-0.8-5.8-1.2-8.9-1.2c-2.4,0-4.8,0.3-7.1,0.8c-16.7,2-39.8,9.6-62.3,23.9C13.7,47.8,27.7,28.5,47.2,18.2L47.2,18.2z M10,80c0-0.8,0-1.7,0.1-2.5C25.7,67,41.8,59.9,55.9,55.9c-3.8,3.8-6.6,8.5-8.3,13.6l0,0c-6.7,15.5-11.6,39.3-10.5,65.8C20.6,122.5,10,102.5,10,80L10,80z M80,150c-13.6,0-26.4-3.9-37.1-10.7c-1.3-18.8,0.7-36.3,4.2-50.5c1.4,5.2,4,10,7.6,14l0,0c10.1,13.5,28.2,29.7,51.8,42C98,148.3,89.1,150,80,150L80,150z',
    'M105.6,145.1c-14.9-8.6-27.5-18.5-37.3-28.1c3.8,1.2,7.7,1.8,11.6,1.8c2.8,0,5.5-0.3,8.1-0.9v0c16.3-1.9,37.8-8.5,59.7-20.4C142.2,119.3,126.3,137,105.6,145.1z M150,80c0,3.5-0.3,6.9-0.8,10.3c-14.9,8.6-29.9,14.6-43.1,18.3c4.9-4.5,8.7-10.2,10.8-16.6l0,0c6.5-15.1,11.6-37,12.2-61.9C142,42.8,150,60.5,150,80L150,80z M80,10c16.5,0,31.6,5.7,43.6,15.3c0,17.2-2.3,33.1-5.7,46.4c-1.5-6.7-4.7-12.7-9.1-17.6l0,0C99,40.9,82.6,25.5,61.3,12.5C67.4,10.8,73.7,10,80,10z M54.4,14.9C69.3,23.5,81.9,33.4,91.6,43c-3.8-1.2-7.7-1.8-11.6-1.8c-2.7,0-5.4,0.3-8.1,0.9v0C55.6,44,34.1,50.5,12.2,62.5C17.8,40.7,33.7,23,54.4,14.9L54.4,14.9z M10,80c0-3.5,0.3-6.9,0.8-10.3c14.9-8.6,29.9-14.6,43.1-18.3C49,55.9,45.2,61.6,43.1,68l0,0c-6.5,15.1-11.6,37-12.2,61.9C18,117.2,10,99.5,10,80L10,80z M80,150c-16.5,0-31.6-5.7-43.6-15.3c0-17.2,2.3-33.1,5.7-46.4c1.5,6.7,4.7,12.7,9.1,17.6l0,0c9.8,13.1,26.3,28.5,47.5,41.5C92.6,149.2,86.3,150,80,150L80,150z',
    'M97.3,147.8c-12.7-8.4-23.6-17.5-32.4-26.3c4.7,1.7,9.7,2.7,15,2.7c3.1,0,6.2-0.3,9.3-1v0c15.5-1.8,35.1-7.3,55.6-16.9C136.6,126.7,119,142.3,97.3,147.8L97.3,147.8z M150,80c0,6.4-0.9,12.8-2.6,18.9c-13.6,6.8-26.9,11.7-38.9,14.8c6.3-5.3,11-12.3,13.6-20.2l0,0c6.2-14.3,11.2-34,13.2-56.6C144.5,48.9,150,63.8,150,80z M80,10c19.6,0,37.4,8.1,50.1,21.2c-1,15.1-3.4,29.1-6.6,41.1c-1.5-8.3-5.3-15.8-10.7-21.8l0.1,0c-9.3-12.5-23.9-26.7-42.5-39.7C73.5,10.2,76.8,10,80,10z M62.7,12.2C75.4,20.6,86.2,29.6,95,38.5c-4.7-1.7-9.7-2.7-15-2.7c-3.2,0-6.3,0.4-9.3,1v0c-15.5,1.8-35.1,7.3-55.6,16.9C23.4,33.3,41,17.7,62.7,12.2L62.7,12.2z M10,80c0-6.6,0.9-12.9,2.6-18.9c13.6-6.8,26.9-11.7,38.9-14.8c-6.2,5.3-11,12.2-13.6,20.2l0,0c-6.1,14.3-11.2,34-13.2,56.6C15.5,111.1,10,96.2,10,80z M80,150c-19.6,0-37.4-8.1-50.1-21.2c1-15.1,3.4-29.1,6.6-41.1c1.5,8.3,5.3,15.8,10.7,21.8l-0.1,0c9.3,12.5,23.9,26.7,42.5,39.7C86.5,149.8,83.2,150,80,150z',
    'M87.3,149.6c-10-7.5-18.8-15.3-26.2-22.9c6,2.5,12.4,3.7,18.9,3.7c3.6,0,7.1-0.4,10.6-1.1l0,0c14.1-1.7,31.2-6,49.4-13.2C128.9,134.4,109.6,147.3,87.3,149.6L87.3,149.6z M150,80c0,9.8-2.1,19.5-6.1,28.5c-11.6,4.9-22.7,8.6-33,11.3c7.9-6.1,13.9-14.6,17.1-24.3l0,0c5.6-13,10.4-30,13.3-49.3C147,56.5,150,68.1,150,80L150,80z M136.6,38.9c-1.5,12.4-3.9,24-6.8,34.2c-1.4-10.3-5.9-19.5-12.6-26.8l0.1,0c-8.5-11.4-20.7-24-36.1-36.2C104,10.4,124.1,21.7,136.6,38.9z M72.7,10.3c10,7.5,18.8,15.3,26.2,22.9c-5.8-2.4-12.2-3.7-18.9-3.7c-3.6,0-7.2,0.4-10.6,1.1v0c-14.1,1.7-31.2,6-49.4,13.2C31.1,25.5,50.4,12.7,72.7,10.3L72.7,10.3z M10,80c0-9.8,2.1-19.5,6.1-28.5c11.6-4.9,22.7-8.6,33-11.3C41.2,46.4,35.2,54.8,32,64.5l0,0c-5.6,13-10.4,30-13.3,49.3C13,103.5,10,91.8,10,80L10,80z M23.4,121.1c1.5-12.4,3.9-24,6.8-34.2c1.4,10.3,5.9,19.5,12.6,26.9l-0.1,0c8.5,11.4,20.8,24,36.1,36.2C56,149.5,35.9,138.3,23.4,121.1L23.4,121.1z',
    'M80,150c-1.7,0-3.4-0.1-5.1-0.2c-6.8-5.8-12.9-11.6-18.4-17.3c7.2,3.2,15.1,5.1,23.5,5.1c4.2,0,8.2-0.5,12.1-1.3l0,0c11.6-1.4,25-4.3,39.4-8.9C118.7,141.3,100.4,150,80,150z M150,80c0,14-4.2,27.7-12.1,39.3c-8.4,3-16.6,5.4-24.3,7.3c9.8-7.1,17.3-17.2,21.1-29l0,0c4.6-10.8,8.8-23.9,12-38.7C148.9,65.8,150,72.9,150,80L150,80z M143,49.5c-1.6,8.7-3.6,16.9-5.8,24.5c-1.3-12.5-6.6-23.7-14.6-32.6l0.1-0.1c-7-9.4-16.3-19.5-27.5-29.7C116.2,16.3,133.8,30.5,143,49.5L143,49.5z M80,10c1.7,0,3.4,0.1,5.1,0.2C91.9,16,98,21.8,103.5,27.5c-7.2-3.2-15.1-5.1-23.5-5.1c-4.2,0-8.2,0.5-12.1,1.3l0,0c-11.6,1.4-25,4.3-39.4,8.9C41.3,18.7,59.6,10,80,10L80,10z M10,80c0-14,4.2-27.7,12.1-39.3c8.4-3,16.6-5.4,24.3-7.3c-9.8,7.1-17.3,17.2-21.1,29l0,0c-4.6,10.8-8.8,23.9-12,38.7C11.1,94.2,10,87.1,10,80L10,80z M17,110.5c1.6-8.7,3.6-16.9,5.8-24.5c1.3,12.5,6.7,23.7,14.6,32.6l-0.1,0.1c7,9.4,16.3,19.6,27.5,29.7C43.8,143.7,26.2,129.5,17,110.5L17,110.5z',
  ]

  useEffect(() => {
    if (!svgRef.current) return

    const stagger = 1
    const targets = gsap.utils.toArray(
      svgRef.current.querySelectorAll('path'),
    ) as SVGPathElement[]
    const r = gsap.utils.random

    if (targets[0]) {
      gsap.set(targets[0], { autoAlpha: 1 })
    }

    const aperture = gsap.timeline({ paused: true })
    aperture.set(targets, { autoAlpha: 1, stagger: stagger })
    aperture.set(targets, { autoAlpha: 0, stagger: stagger }, stagger)

    apertureRef.current = aperture

    const randomPlay = () => {
      const randomProgress = r(0.5, 0.99)

      gsap.to(aperture, {
        duration: r(0.4, 1),
        delay: r(0, 1),
        progress: randomProgress,
        yoyo: true,
        repeat: 1,
        repeatDelay: r(0.5, 1.5),
        ease: 'power4.inOut',
        onComplete: randomPlay,
        onUpdate: () => {
          const mappedProgress = (aperture.progress() / randomProgress) * 100
          setPercentage(Math.floor(mappedProgress))
        },
      })
    }

    randomPlay()

    return () => {
      aperture.kill()
    }
  }, [])

  return (
    <div className={cn('flex flex-col items-center justify-center', className)}>
      <div className='relative text-foreground'>
        <svg
          ref={svgRef}
          width={size}
          height={size}
          viewBox='0 0 160 160'
          className='text-foreground'
        >
          <title>Aperture Animation</title>
          {paths.map((path) => (
            <path
              key={path}
              d={path}
              fill='currentColor'
              style={{ opacity: 0 }}
            />
          ))}
        </svg>
      </div>

      {showPercentage && (
        <div className='mt-4 text-center'>
          <p className='font-mono text-foreground text-lg'>
            Percentage: <span className='font-bold'>{percentage}</span>%
          </p>
        </div>
      )}
    </div>
  )
}
